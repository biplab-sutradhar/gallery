---
title: "Animint2 Gallery"
output: html_document
---

```{r setup, include=FALSE}
library(knitr)
library(data.table)
library(nc)

# Function to create HTML links
ahref <- function(href, text){
  sprintf('<a href="%s">%s</a>', href, text)
}

# Function to process meta.csv
myread <- function(csv, repo.col){
  if(!file.exists(csv)) {
    return(data.table())
  }
  dt <- fread(csv)
  if(nrow(dt) == 0) {
    return(data.table())
  }
  dt[, c("owner", "repo_only") := tstrsplit(viz_owner_repo, "/")]
  dt[, img.png := sprintf("repos/%s.png", viz_owner_repo)]
  dt[, viz.link := ahref(
    sprintf("https://%s.github.io/%s/", owner, repo_only),
    ifelse(
      file.exists(img.png),
      sprintf('<img src="%s" alt="%s" />', img.png, viz_owner_repo),
      viz_owner_repo)
  )]
  dt[, repo.link := ahref(
    sprintf("https://github.com/%s/tree/gh-pages", viz_owner_repo),
    get(repo.col))]
  return(dt)
}

# Read meta.csv and error.csv
meta.dt <- myread("meta.csv", "title")
if(nrow(meta.dt) > 0) {
  meta.dt[, source.link := ahref(source, commit.POSIXct)]
}
error.dt <- myread("error.csv", "viz_owner_repo")